---
title: ReFoRCE SQL Agent Workflow
---
graph TD
    %% Main Workflow
    A[🤔 User Question] --> B[📊 Database Info Compression]
    B --> C[📋 Format Restriction Generation]
    C --> D[🔍 Column Exploration]
    D --> E[⚡ Parallel SQL Generation]
    E --> F[🔄 Self-Refinement]
    F --> G[🗳️ Consensus Voting]
    G --> H[✅ Final Validation]
    H --> I[📝 Final Answer]

    %% Database Info Compression Details
    B --> B1[🏷️ Pattern-based<br/>Table Grouping]
    B --> B2[📏 Schema Size<br/>Analysis]
    B --> B3[🎯 Representative<br/>Selection]

    %% Format Restriction Details
    C --> C1[🔍 Format<br/>Analysis]
    C --> C2[📋 Column<br/>Specification]
    C --> C3[💡 Example<br/>Generation]

    %% Column Exploration Details
    D --> D1[🔧 Exploration Query<br/>Generation]
    D --> D2[▶️ Query<br/>Execution]
    D --> D3[💎 Insight<br/>Extraction]

    %% Parallel Generation Details
    E --> E1[🔀 Context<br/>Variation]
    E --> E2[⚡ Parallel SQL<br/>Generation]
    E --> E3[📦 Candidate<br/>Collection]

    %% Self-Refinement Details
    F --> F1[🔍 Self-Consistency<br/>Check]
    F --> F2[🛠️ Error<br/>Correction]
    F --> F3[✨ Query<br/>Refinement]

    %% Consensus Voting Details
    G --> G1[▶️ Result<br/>Execution]
    G --> G2[⚖️ Result<br/>Comparison]
    G --> G3[🗳️ Majority<br/>Vote]

    %% Final Validation Details
    H --> H1[📊 Confidence<br/>Scoring]
    H --> H2[✅ Final<br/>Validation]
    H --> H3[📝 Response<br/>Formatting]

    %% Styling
    classDef startEnd fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef mainProcess fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef subProcess fill:#e8f5e8,stroke:#388e3c,stroke-width:1px,color:#000
    classDef innovation fill:#fff8e1,stroke:#f57c00,stroke-width:2px,color:#000

    class A,I startEnd
    class B,C,D,E,F,G,H mainProcess
    class B1,B2,B3,C1,C2,C3,D1,D2,D3,E1,E2,E3,F1,F2,F3,G1,G2,G3,H1,H2,H3 subProcess
