---
title: ReFoRCE SQL Agent Workflow
---
graph TD
    %% Main Workflow
    A[ğŸ¤” User Question] --> B[ğŸ“Š Database Info Compression]
    B --> C[ğŸ“‹ Format Restriction Generation]
    C --> D[ğŸ” Column Exploration]
    D --> E[âš¡ Parallel SQL Generation]
    E --> F[ğŸ”„ Self-Refinement]
    F --> G[ğŸ—³ï¸ Consensus Voting]
    G --> H[âœ… Final Validation]
    H --> I[ğŸ“ Final Answer]

    %% Database Info Compression Details
    B --> B1[ğŸ·ï¸ Pattern-based<br/>Table Grouping]
    B --> B2[ğŸ“ Schema Size<br/>Analysis]
    B --> B3[ğŸ¯ Representative<br/>Selection]

    %% Format Restriction Details
    C --> C1[ğŸ” Format<br/>Analysis]
    C --> C2[ğŸ“‹ Column<br/>Specification]
    C --> C3[ğŸ’¡ Example<br/>Generation]

    %% Column Exploration Details
    D --> D1[ğŸ”§ Exploration Query<br/>Generation]
    D --> D2[â–¶ï¸ Query<br/>Execution]
    D --> D3[ğŸ’ Insight<br/>Extraction]

    %% Parallel Generation Details
    E --> E1[ğŸ”€ Context<br/>Variation]
    E --> E2[âš¡ Parallel SQL<br/>Generation]
    E --> E3[ğŸ“¦ Candidate<br/>Collection]

    %% Self-Refinement Details
    F --> F1[ğŸ” Self-Consistency<br/>Check]
    F --> F2[ğŸ› ï¸ Error<br/>Correction]
    F --> F3[âœ¨ Query<br/>Refinement]

    %% Consensus Voting Details
    G --> G1[â–¶ï¸ Result<br/>Execution]
    G --> G2[âš–ï¸ Result<br/>Comparison]
    G --> G3[ğŸ—³ï¸ Majority<br/>Vote]

    %% Final Validation Details
    H --> H1[ğŸ“Š Confidence<br/>Scoring]
    H --> H2[âœ… Final<br/>Validation]
    H --> H3[ğŸ“ Response<br/>Formatting]

    %% Styling
    classDef startEnd fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef mainProcess fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef subProcess fill:#e8f5e8,stroke:#388e3c,stroke-width:1px,color:#000
    classDef innovation fill:#fff8e1,stroke:#f57c00,stroke-width:2px,color:#000

    class A,I startEnd
    class B,C,D,E,F,G,H mainProcess
    class B1,B2,B3,C1,C2,C3,D1,D2,D3,E1,E2,E3,F1,F2,F3,G1,G2,G3,H1,H2,H3 subProcess
