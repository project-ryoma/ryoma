---
title: Enhanced SQL Agent Workflow
---
graph TD
    %% Main Workflow
    A[ğŸ¤” User Question] --> B[ğŸ” Analyze Question]
    B --> C[ğŸ”— Schema Linking]
    C --> D[ğŸ“‹ Query Planning]
    D --> E[âš¡ Generate SQL]
    E --> F[ğŸ›¡ï¸ Validate Safety]

    %% Safety Check Branch
    F --> G{ğŸ”’ Safety Check}
    G -->|âœ… Pass| H[â–¶ï¸ Execute Query]
    G -->|âŒ Fail| M[ğŸ“ Format Response]

    %% Execution Branch
    H --> I{ğŸ“Š Execution Result}
    I -->|âœ… Success| M[ğŸ“ Format Response]
    I -->|âŒ Error| J[ğŸ› ï¸ Handle Error]
    I -->|ğŸ”„ Retry Needed| E

    %% Error Handling Branch
    J --> K{ğŸ¤” Should Retry?}
    K -->|ğŸ”„ Yes, Retry < Max| E
    K -->|ğŸ›‘ No, Give Up| M

    %% Final Output
    M --> N[ğŸ“ Final Answer]

    %% Styling
    classDef startEnd fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef process fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef decision fill:#fff8e1,stroke:#f57c00,stroke-width:2px,color:#000
    classDef error fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000
    classDef success fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,color:#000

    class A,N startEnd
    class B,C,D,E,H,M process
    class G,I,K decision
    class J error
    class F success
